<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSP Component Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            900: '#0a0a0f',
                            800: '#12121a',
                            700: '#1a1a24',
                            600: '#22222e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-hover:hover {
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.12);
        }
        .version-pill.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }
        .go-badge {
            background: linear-gradient(135deg, #00add8 0%, #00a29c 100%);
        }
        .go-badge-warn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .stale-badge {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .cve-badge-critical {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        }
        .cve-badge-high {
            background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
        }
        .cve-badge-medium {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        }
        .cve-badge-low {
            background: linear-gradient(135deg, #65a30d 0%, #4d7c0f 100%);
        }
        .cve-badge-unknown {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
        }
        .mismatch-badge {
            background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
        }
    </style>
</head>
<body class="bg-dark-900 text-gray-100 min-h-screen">
    <!-- Background gradient -->
    <div class="fixed inset-0 bg-gradient-to-br from-blue-900/20 via-purple-900/10 to-dark-900 pointer-events-none"></div>

    <div class="relative z-10 max-w-7xl mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2">
                OSP Component Dashboard
            </h1>
            <p class="text-gray-400">OpenShift Pipelines version tracking</p>
        </header>

        <!-- Version Selector -->
        <div class="flex justify-center flex-wrap gap-3 mb-6">
            {% for version in versions %}
            <button
                class="version-pill px-6 py-2 rounded-full glass text-sm font-medium transition-all duration-200 hover:scale-105 {% if loop.first %}active text-white{% else %}text-gray-300 hover:text-white{% endif %}"
                onclick="showVersion('{{ version }}')"
                data-version="{{ version }}"
            >
                OSP {{ version }}
                {% if version_stats[version].has_go_mismatch or version_stats[version].has_dep_mismatch %}
                <span class="ml-1 text-yellow-400" title="{% if version_stats[version].has_go_mismatch %}Go version mismatch{% endif %}{% if version_stats[version].has_go_mismatch and version_stats[version].has_dep_mismatch %}, {% endif %}{% if version_stats[version].has_dep_mismatch %}Dependency version mismatch{% endif %}">âš </span>
                {% endif %}
                {% if version_stats[version].total_cves > 0 %}
                <span class="ml-1 text-red-400" title="{{ version_stats[version].total_cves }} CVE(s) affecting this version">ðŸ›¡</span>
                {% endif %}
            </button>
            {% endfor %}
        </div>

        <!-- View Toggle -->
        <div class="flex justify-center gap-2 mb-10">
            <button
                id="view-cards"
                class="view-toggle px-4 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 active bg-white/10 text-white"
                onclick="setView('cards')"
            >
                Cards
            </button>
            <button
                id="view-table"
                class="view-toggle px-4 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 text-gray-400 hover:text-white hover:bg-white/5"
                onclick="setView('table')"
            >
                Table
            </button>
        </div>

        <!-- Component Cards Container -->
        {% for version in versions %}
        <div
            id="version-{{ version }}"
            class="version-content {% if not loop.first %}hidden{% endif %}"
        >
            <!-- Version-level warnings -->
            {% if version_stats[version].has_go_mismatch %}
            <div class="mb-4 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
                <p class="text-yellow-400 text-sm flex items-center gap-2">
                    <span class="text-lg">âš </span>
                    <strong>Go version mismatch:</strong>
                    Components use different Go versions: {{ version_stats[version].go_versions | join(', ') }}
                </p>
            </div>
            {% endif %}

            {% if version_stats[version].has_dep_mismatch %}
            <div class="mb-4 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
                <p class="text-yellow-400 text-sm flex items-center gap-2">
                    <span class="text-lg">âš </span>
                    <strong>Dependency version mismatch:</strong>
                    {{ version_stats[version].mismatched_deps | join(', ') }}
                </p>
            </div>
            {% endif %}

            {% if version_stats[version].total_cves > 0 %}
            <div class="mb-4 p-4 rounded-lg bg-red-500/10 border border-red-500/30">
                <p class="text-red-400 text-sm flex items-center gap-2">
                    <span class="text-lg">ðŸ›¡</span>
                    <strong>Security advisories ({{ version_stats[version].total_cves }}):</strong>
                    {% for cve in version_stats[version].cve_details %}
                    <a href="{{ cve.url }}" target="_blank" class="hover:text-red-300">{{ cve.id }} ({{ cve.component }})</a>{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </p>
            </div>
            {% endif %}

            <!-- Cards View -->
            <div class="cards-view grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for comp in versions_data[version] %}
            <div class="glass glass-hover rounded-xl p-6 transition-all duration-200">
                <!-- Component Header -->
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <a
                            href="https://github.com/{{ comp.owner }}/{{ comp.repo }}"
                            target="_blank"
                            class="text-lg font-semibold text-white hover:text-blue-400 transition-colors"
                        >
                            {{ comp.owner }}/{{ comp.repo }}
                        </a>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="px-2 py-0.5 rounded bg-blue-500/20 text-blue-300 font-mono text-sm font-medium">
                                {{ comp.ref }}
                            </span>
                            <span class="{% if comp.go_version_mismatch %}go-badge-warn{% else %}go-badge{% endif %} px-2 py-0.5 rounded-full text-xs font-bold text-white" {% if comp.go_version_mismatch %}title="Different from other components in this release"{% endif %}>
                                Go {{ comp.go_version }}{% if comp.go_version_mismatch %} âš {% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Internal Dependencies (Cross-dependencies) -->
                {% if comp.internal_deps %}
                <div class="mb-4">
                    <p class="text-xs text-orange-400 uppercase tracking-wider mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-orange-400"></span>
                        Tekton Dependencies
                    </p>
                    <div class="space-y-1.5">
                        {% for dep in comp.internal_deps %}
                        <div class="flex items-center justify-between text-sm">
                            <span class="{% if dep.is_stale %}text-red-300{% else %}text-orange-200{% endif %} truncate max-w-[50%]" title="{{ dep.path }}">
                                {{ dep.path.split('/')[-1] if '/' in dep.path else dep.path }}
                            </span>
                            <div class="flex items-center gap-2">
                                {% if dep.is_stale %}
                                <span class="stale-badge px-1.5 py-0.5 rounded text-[10px] font-bold text-white" title="Stale: bundled version is {{ dep.bundled_version }}">
                                    STALE
                                </span>
                                {% endif %}
                                <span class="{% if dep.is_stale %}text-red-400{% else %}text-orange-400{% endif %} font-mono text-xs" {% if dep.is_stale %}title="Bundled: {{ dep.bundled_version }}"{% endif %}>
                                    {{ dep.version }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- External Dependencies -->
                {% if comp.external_deps %}
                <div class="space-y-2">
                    <p class="text-xs text-gray-500 uppercase tracking-wider mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-purple-400"></span>
                        External Dependencies
                    </p>
                    <div class="space-y-1.5">
                        {% for dep in comp.external_deps %}
                        <div class="flex items-center justify-between text-sm">
                            <span class="{% if dep.version_differs %}text-yellow-300{% else %}text-gray-300{% endif %} truncate max-w-[50%]" title="{{ dep.path }}">
                                {{ dep.path.split('/')[-1] if '/' in dep.path else dep.path }}
                            </span>
                            <div class="flex items-center gap-2">
                                {% if dep.version_differs %}
                                <span class="mismatch-badge px-1.5 py-0.5 rounded text-[10px] font-bold text-white" title="Version mismatch: expected {{ dep.expected_version }}">
                                    MISMATCH
                                </span>
                                {% endif %}
                                <span class="{% if dep.version_differs %}text-yellow-400{% else %}text-purple-400{% endif %} font-mono text-xs" {% if dep.version_differs %}title="Expected: {{ dep.expected_version }}"{% endif %}>
                                    {{ dep.version }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if not comp.internal_deps and not comp.external_deps %}
                <p class="text-gray-500 text-sm italic">No highlighted dependencies</p>
                {% endif %}

                <!-- CVEs -->
                {% if comp.cves %}
                <div class="mt-4">
                    <p class="text-xs text-red-400 uppercase tracking-wider mb-2 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-red-400"></span>
                        Security Advisories ({{ comp.cves | length }})
                    </p>
                    <div class="space-y-1.5">
                        {% for cve in comp.cves %}
                        <div class="flex items-center justify-between text-sm">
                            <a href="{{ cve.url }}" target="_blank" class="text-red-300 hover:text-red-200 truncate max-w-[70%]" title="{{ cve.summary }}">
                                {{ cve.id }}
                            </a>
                            <span class="cve-badge-{{ cve.severity }} px-1.5 py-0.5 rounded text-[10px] font-bold text-white uppercase">
                                {{ cve.severity }}
                            </span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Footer -->
                <div class="mt-4 pt-4 border-t border-white/5">
                    <p class="text-xs text-gray-500">
                        {{ comp.total_deps }} total dependencies
                        {% if comp.cves %} Â· <span class="text-red-400">{{ comp.cves | length }} CVE(s)</span>{% endif %}
                    </p>
                </div>
            </div>
            {% endfor %}
            </div>

            <!-- Table View -->
            <div class="table-view hidden overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-white/10">
                            <th class="text-left py-3 px-4 text-gray-400 font-medium">Component</th>
                            <th class="text-left py-3 px-4 text-gray-400 font-medium">Ref</th>
                            <th class="text-left py-3 px-4 text-gray-400 font-medium">Go</th>
                            <th class="text-left py-3 px-4 text-gray-400 font-medium">Stale Deps</th>
                            <th class="text-left py-3 px-4 text-gray-400 font-medium">Mismatched Deps</th>
                            <th class="text-left py-3 px-4 text-gray-400 font-medium">CVEs</th>
                            <th class="text-right py-3 px-4 text-gray-400 font-medium">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comp in versions_data[version] %}
                        <tr class="border-b border-white/5 hover:bg-white/5 transition-colors">
                            <td class="py-3 px-4">
                                <a href="https://github.com/{{ comp.owner }}/{{ comp.repo }}" target="_blank" class="text-white hover:text-blue-400 transition-colors font-medium">
                                    {{ comp.repo }}
                                </a>
                            </td>
                            <td class="py-3 px-4 text-gray-500 font-mono text-xs">{{ comp.ref }}</td>
                            <td class="py-3 px-4">
                                <span class="{% if comp.go_version_mismatch %}text-yellow-400{% else %}text-cyan-400{% endif %} font-mono text-xs">
                                    {{ comp.go_version }}{% if comp.go_version_mismatch %} âš {% endif %}
                                </span>
                            </td>
                            <td class="py-3 px-4">
                                {% set stale_deps = comp.internal_deps | selectattr('is_stale') | list %}
                                {% if stale_deps %}
                                <div class="flex flex-wrap gap-x-3 gap-y-1">
                                    {% for dep in stale_deps %}
                                    <span class="font-mono text-xs" title="{{ dep.path }} (bundled: {{ dep.bundled_version }})">
                                        <span class="text-red-300">{{ dep.path.split('/')[-1] }}</span><span class="text-red-500">@{{ dep.version }}</span>
                                    </span>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <span class="text-gray-600">-</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                {% set mismatched_deps = comp.external_deps | selectattr('version_differs') | list %}
                                {% if mismatched_deps %}
                                <div class="flex flex-wrap gap-x-3 gap-y-1">
                                    {% for dep in mismatched_deps %}
                                    <span class="font-mono text-xs" title="{{ dep.path }} (expected: {{ dep.expected_version }})">
                                        <span class="text-yellow-300">{{ dep.path.split('/')[-1] }}</span><span class="text-yellow-500">@{{ dep.version }}</span>
                                    </span>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <span class="text-gray-600">-</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                {% if comp.cves %}
                                <div class="flex flex-wrap gap-1">
                                    {% for cve in comp.cves %}
                                    <a href="{{ cve.url }}" target="_blank" class="cve-badge-{{ cve.severity }} px-1.5 py-0.5 rounded text-[10px] font-bold text-white" title="{{ cve.id }}: {{ cve.summary }}">
                                        {{ cve.severity[:1] | upper }}
                                    </a>
                                    {% endfor %}
                                </div>
                                {% else %}
                                <span class="text-gray-600">-</span>
                                {% endif %}
                            </td>
                            <td class="py-3 px-4 text-right text-gray-500">{{ comp.total_deps }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endfor %}

        <!-- Footer -->
        <footer class="text-center mt-16 space-y-3">
            <p class="text-gray-400 text-sm">
                Vibed with <span class="text-pink-400">â™¥</span> by
                <a href="https://github.com/vdemeester" class="bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent hover:from-purple-400 hover:to-pink-400 transition-all">@vdemeester</a>
            </p>
            <p class="text-gray-600 text-xs">
                <a href="https://github.com/openshift-pipelines/osp-component-dashboard" class="hover:text-blue-400 transition-colors">Source</a>
                <span class="mx-2 text-gray-700">Â·</span>
                <a href="https://github.com/openshift-pipelines" class="hover:text-purple-400 transition-colors">OpenShift Pipelines</a>
            </p>
        </footer>
    </div>

    <script>
        let currentView = 'cards';

        function showVersion(version) {
            // Hide all version content
            document.querySelectorAll('.version-content').forEach(el => {
                el.classList.add('hidden');
            });

            // Show selected version content
            document.getElementById('version-' + version).classList.remove('hidden');

            // Update pill styles
            document.querySelectorAll('.version-pill').forEach(pill => {
                if (pill.dataset.version === version) {
                    pill.classList.add('active', 'text-white');
                    pill.classList.remove('text-gray-300');
                } else {
                    pill.classList.remove('active', 'text-white');
                    pill.classList.add('text-gray-300');
                }
            });
        }

        function setView(view) {
            currentView = view;

            // Update toggle buttons
            document.querySelectorAll('.view-toggle').forEach(btn => {
                btn.classList.remove('active', 'bg-white/10', 'text-white');
                btn.classList.add('text-gray-400');
            });
            document.getElementById('view-' + view).classList.add('active', 'bg-white/10', 'text-white');
            document.getElementById('view-' + view).classList.remove('text-gray-400');

            // Toggle view visibility
            document.querySelectorAll('.cards-view').forEach(el => {
                el.classList.toggle('hidden', view !== 'cards');
            });
            document.querySelectorAll('.table-view').forEach(el => {
                el.classList.toggle('hidden', view !== 'table');
            });
        }
    </script>
</body>
</html>
